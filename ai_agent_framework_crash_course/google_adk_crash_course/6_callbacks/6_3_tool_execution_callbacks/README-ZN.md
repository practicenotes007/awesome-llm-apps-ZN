# ğŸ¯ æ•™ç¨‹6.3ï¼šå·¥å…·æ‰§è¡Œå›è°ƒ

## ğŸ¯ æ‚¨å°†å­¦åˆ°ä»€ä¹ˆ
- **å‰ç½®å·¥å…·å›è°ƒ**ï¼šç›‘æ§å·¥å…·ä½•æ—¶å¼€å§‹æ‰§è¡Œ
- **åç½®å·¥å…·å›è°ƒ**ï¼šè·Ÿè¸ªå·¥å…·å®Œæˆå’Œç»“æœ
- **å·¥å…·ä¸Šä¸‹æ–‡**ï¼šç†è§£å¦‚ä½•ç›‘æ§å·¥å…·æ‰§è¡Œ

## ğŸ§  æ ¸å¿ƒæ¦‚å¿µï¼šå·¥å…·æ‰§è¡Œç›‘æ§

å·¥å…·æ‰§è¡Œå›è°ƒå…è®¸æ‚¨ç›‘æ§ä»£ç†ä½•æ—¶ä½¿ç”¨å·¥å…·ã€è·Ÿè¸ªå…¶æ‰§è¡Œç”Ÿå‘½å‘¨æœŸå¹¶åˆ†æç»“æœã€‚è¿™æä¾›äº†ä»£ç†å¦‚ä½•ä¸å¤–éƒ¨ç³»ç»Ÿå’ŒAPIäº¤äº’çš„å¯è§æ€§ã€‚

### **å·¥å…·æ‰§è¡Œæµç¨‹**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å·¥å…·è°ƒç”¨      â”‚â”€â”€â”€â–¶â”‚  å‰ç½®å·¥å…·       â”‚â”€â”€â”€â–¶â”‚  å·¥å…·æ‰§è¡Œ       â”‚
â”‚   (ä»£ç†)        â”‚    â”‚   å›è°ƒ          â”‚    â”‚   (å¤–éƒ¨)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚                       â”‚
                              â–¼                       â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚  åç½®å·¥å…·       â”‚    â”‚  å·¥å…·ç»“æœ       â”‚
                       â”‚   å›è°ƒ          â”‚    â”‚   (ä»£ç†)        â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **å›è°ƒæ‰§è¡Œæ—¶é—´çº¿**
```
æ—¶é—´ â†’ 0ms    5ms    10ms   15ms   20ms   25ms
       â”‚      â”‚      â”‚      â”‚      â”‚      â”‚
       â–¼      â–¼      â–¼      â–¼      â–¼      â–¼
    [å·¥å…·] [å‰ç½®] [æ‰§è¡Œ] [åç½®] [ç»“æœ]
    è°ƒç”¨   å›è°ƒ   å¼€å§‹   å›è°ƒ   è¿”å›
```

### **ä½¿ç”¨åœºæ™¯**
- **æ‰§è¡Œç›‘æ§**ï¼šè·Ÿè¸ªå·¥å…·ä½•æ—¶å¼€å§‹å’Œå®Œæˆ
- **å‚æ•°éªŒè¯**ï¼šåœ¨æ‰§è¡Œå‰æ£€æŸ¥å·¥å…·è¾“å…¥
- **ç»“æœè®°å½•**ï¼šè®°å½•å·¥å…·è¾“å‡ºå’Œé”™è¯¯
- **è°ƒè¯•**ï¼šç†è§£å·¥å…·æ‰§è¡Œæ¨¡å¼
- **åˆ†æ**ï¼šç›‘æ§å“ªäº›å·¥å…·ä½¿ç”¨æœ€å¤š

## ğŸš€ æ•™ç¨‹æ¦‚è¿°

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå¸¦æœ‰å·¥å…·æ‰§è¡Œå›è°ƒçš„ä»£ç†ï¼Œå®ƒå¯ä»¥ï¼š
- ä½¿ç”¨ç®€å•çš„è®¡ç®—å™¨å·¥å…·
- ç›‘æ§å·¥å…·æ‰§è¡Œçš„å¼€å§‹å’Œç»“æŸ
- è·Ÿè¸ªå·¥å…·å‚æ•°å’Œç»“æœ
- æä¾›è¯¦ç»†çš„å·¥å…·ä½¿ç”¨å¯è§æ€§

## ğŸ“ é¡¹ç›®ç»“æ„

```
6_3_tool_execution_callbacks/
â”œâ”€â”€ README.md              # æœ¬æ–‡ä»¶
â”œâ”€â”€ requirements.txt       # ä¾èµ–é¡¹
â”œâ”€â”€ agent.py              # å¸¦å·¥å…·å›è°ƒçš„ä»£ç†
â””â”€â”€ app.py                # Streamlitç•Œé¢
```

## ğŸ¯ å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬æ•™ç¨‹åï¼Œæ‚¨å°†ç†è§£ï¼š

- âœ… **å‰ç½®å·¥å…·å›è°ƒ**ï¼šå¦‚ä½•ç›‘æ§å·¥å…·æ‰§è¡Œå¼€å§‹
- âœ… **åç½®å·¥å…·å›è°ƒ**ï¼šå¦‚ä½•è·Ÿè¸ªå·¥å…·å®Œæˆ
- âœ… **å·¥å…·ä¸Šä¸‹æ–‡**ï¼šå¦‚ä½•è®¿é—®å·¥å…·å’Œä»£ç†ä¿¡æ¯
- âœ… **FunctionTool**ï¼šå¦‚ä½•æ­£ç¡®æ³¨å†Œå¸¦å›è°ƒçš„å·¥å…·
- âœ… **å›è°ƒé›†æˆ**ï¼šå¦‚ä½•å°†å›è°ƒä¸ä»£ç†é›†æˆ

## ğŸš€ å¼€å§‹ä½¿ç”¨

### **è®¾ç½®**
1. **å®‰è£…ä¾èµ–é¡¹**ï¼š`pip install -r requirements.txt`
2. **è®¾ç½®ç¯å¢ƒ**ï¼šåˆ›å»ºåŒ…å«`GOOGLE_API_KEY=your_key`çš„`.env`æ–‡ä»¶
3. **è¿è¡Œåº”ç”¨**ï¼š`streamlit run app.py`

### **æµ‹è¯•ä»£ç†**
```bash
# è¿è¡ŒStreamlitåº”ç”¨
streamlit run app.py

# å°è¯•è¿™äº›æµ‹è¯•æ¶ˆæ¯ï¼š
- "è®¡ç®—15 + 27"
- "100é™¤ä»¥4ç­‰äºå¤šå°‘ï¼Ÿ"
- "8ä¹˜ä»¥12"
```

## ğŸ”§ å…³é”®æ¦‚å¿µ

### **1. å‰ç½®å·¥å…·å›è°ƒ**
- **è§¦å‘**ï¼šå·¥å…·æ‰§è¡Œå¼€å§‹æ—¶
- **å‚æ•°**ï¼š`tool`ã€`args`ã€`tool_context`
- **ä½¿ç”¨åœºæ™¯**ï¼šè®°å½•å·¥å…·ä½¿ç”¨ã€éªŒè¯å‚æ•°ã€è®°å½•å¼€å§‹

### **2. åç½®å·¥å…·å›è°ƒ**
- **è§¦å‘**ï¼šå·¥å…·æ‰§è¡Œå®Œæˆæ—¶
- **å‚æ•°**ï¼š`tool`ã€`args`ã€`tool_context`ã€`tool_response`
- **ä½¿ç”¨åœºæ™¯**ï¼šè®°å½•ç»“æœã€å¤„ç†é”™è¯¯ã€æä¾›åé¦ˆ

### **3. å·¥å…·ä¸Šä¸‹æ–‡**
- **ä»£ç†ä¿¡æ¯**ï¼šè®¿é—®`tool_context.agent_name`
- **ä»£ç†ä¿¡æ¯**ï¼šè®¿é—®`tool_context.agent_name`
- **çŠ¶æ€ç®¡ç†**ï¼šä½¿ç”¨`tool_context.state`è¿›è¡Œæ•°æ®å…±äº«
- **å·¥å…·è¯¦æƒ…**ï¼šé€šè¿‡`tool.name`è®¿é—®å·¥å…·ä¿¡æ¯

## ğŸ” æµ‹è¯•ç¤ºä¾‹

### **åŸºæœ¬å·¥å…·ä½¿ç”¨**
```
ç”¨æˆ·: "è®¡ç®—15 + 27"

ğŸ”§ å·¥å…·calculator_toolå¼€å§‹
ğŸ“ å‚æ•°: {'operation': 'add', 'a': 15.0, 'b': 27.0}
ğŸ“‹ ä»£ç†: tool_execution_demo_agent

âœ… å·¥å…·calculator_toolå®Œæˆ
â±ï¸ æŒç»­æ—¶é—´: 0.0012s
ğŸ“„ ç»“æœ: 15 + 27 = 42
```

### **é”™è¯¯å¤„ç†**
```
ç”¨æˆ·: "10é™¤ä»¥0ç­‰äºå¤šå°‘ï¼Ÿ"

ğŸ”§ å·¥å…·calculator_toolå¼€å§‹
ğŸ“ å‚æ•°: {'operation': 'divide', 'a': 10.0, 'b': 0.0}
ğŸ“‹ ä»£ç†: tool_execution_demo_agent

âœ… å·¥å…·calculator_toolå®Œæˆ
â±ï¸ æŒç»­æ—¶é—´: 0.0008s
ğŸ“„ ç»“æœ: é”™è¯¯: é™¤é›¶é”™è¯¯
```

## ğŸ¯ æ¯ä¸ªæŒ‡æ ‡çš„å«ä¹‰

### **å‰ç½®å·¥å…·å›è°ƒè¾“å‡º**
- **ğŸ”§ å·¥å…·åç§°**ï¼šæ­£åœ¨æ‰§è¡Œçš„å·¥å…·
- **ğŸ“ å‚æ•°**ï¼šä¼ é€’ç»™å·¥å…·çš„è¾“å…¥å‚æ•°
- **ğŸ“‹ ä»£ç†**ï¼šä½¿ç”¨å·¥å…·çš„ä»£ç†

### **åç½®å·¥å…·å›è°ƒè¾“å‡º**
- **âœ… å®ŒæˆçŠ¶æ€**ï¼šå·¥å…·æ‰§è¡ŒæˆåŠŸå®Œæˆ
- **â±ï¸ æŒç»­æ—¶é—´**ï¼šå·¥å…·æ‰§è¡Œæ‰€éœ€æ—¶é—´
- **ğŸ“„ ç»“æœ**ï¼šå·¥å…·çš„è¾“å‡ºæˆ–ç»“æœ

## ğŸ¯ å…³é”®å®ç°è¯´æ˜

### **FunctionToolè¦æ±‚**
å·¥å…·å¿…é¡»ç”¨`FunctionTool`åŒ…è£…æ‰èƒ½ä½¿å›è°ƒå·¥ä½œï¼š

```python
# âœ… æ­£ç¡® - ä½¿ç”¨FunctionTool
calculator_function_tool = FunctionTool(func=calculator_tool)
agent = LlmAgent(tools=[calculator_function_tool], ...)

# âŒ é”™è¯¯ - åŸå§‹å‡½æ•°ä¸ä¼šè§¦å‘å›è°ƒ
agent = LlmAgent(tools=[calculator_tool], ...)
```

### **å›è°ƒç­¾å**
ä½¿ç”¨æ­£ç¡®çš„å‚æ•°é¡ºåºè¿›è¡Œå·¥å…·å›è°ƒï¼š

```python
# âœ… æ­£ç¡®ç­¾å
def before_tool_callback(tool: BaseTool, args: dict, tool_context: ToolContext):
    pass

def after_tool_callback(tool: BaseTool, args: dict, tool_context: ToolContext, tool_response: any):
    pass
```

### **äº‹ä»¶å¾ªç¯å®Œæˆ**
ä¸è¦åœ¨`is_final_response()`åç«‹å³ä¸­æ–­äº‹ä»¶å¾ªç¯ï¼š

```python
# âœ… è¿™æ ·åš - å…è®¸å›è°ƒå®Œæˆ
if event.is_final_response() and event.content:
    response_text = event.content.parts[0].text.strip()
    # ä¸è¦ä¸­æ–­ - è®©å¾ªç¯è‡ªç„¶å®Œæˆ
```

## ğŸ¯ é«˜çº§æ¨¡å¼

### **å¤šä¸ªå·¥å…·**
ä½¿ç”¨ç›¸åŒå›è°ƒæ³¨å†Œå¤šä¸ªå·¥å…·ï¼š

```python
def weather_tool(city: str) -> str:
    return f"{city}çš„å¤©æ°”: æ™´å¤©, 25Â°C"

def calculator_tool(operation: str, a: float, b: float) -> str:
    # ... å®ç°

# æ³¨å†Œå¤šä¸ªå·¥å…·
weather_function_tool = FunctionTool(func=weather_tool)
calculator_function_tool = FunctionTool(func=calculator_tool)

agent = LlmAgent(
    name="multi_tool_agent",
    model="gemini-2.5-flash",
    tools=[calculator_function_tool, weather_function_tool],
    before_tool_callback=before_tool_callback,
    after_tool_callback=after_tool_callback
)
```

### **å‚æ•°éªŒè¯**
åœ¨before_tool_callbackä¸­å®ç°éªŒè¯ï¼š

```python
def before_tool_callback(tool: BaseTool, args: dict, tool_context: ToolContext):
    tool_name = tool.name
    
    # éªŒè¯è®¡ç®—å™¨å·¥å…·å‚æ•°
    if tool_name == "calculator_tool":
        if "operation" not in args:
            print("âš ï¸ è­¦å‘Š: ç¼ºå°‘æ“ä½œå‚æ•°")
        if "a" not in args or "b" not in args:
            print("âš ï¸ è­¦å‘Š: ç¼ºå°‘æ•°å€¼å‚æ•°")
    
    print(f"ğŸ”§ å·¥å…· {tool_name} å¼€å§‹")
    print(f"ğŸ“ å‚æ•°: {args}")
    return None
```

### **ç»“æœä¿®æ”¹**
åœ¨after_tool_callbackä¸­ä¿®æ”¹å·¥å…·ç»“æœï¼š

```python
def after_tool_callback(tool: BaseTool, args: dict, tool_context: ToolContext, tool_response: any):
    tool_name = tool.name
    
    # ä¸ºè®¡ç®—å™¨ç»“æœæ·»åŠ ä¸Šä¸‹æ–‡
    if tool_name == "calculator_tool" and "result" in tool_response:
        operation = args.get("operation", "unknown")
        tool_response["context"] = f"æ‰§è¡Œäº† {operation} æ“ä½œ"
    
    print(f"âœ… å·¥å…· {tool_name} å®Œæˆ")
    print(f"ğŸ“„ ç»“æœ: {tool_response}")
    return tool_response  # è¿”å›ä¿®æ”¹åçš„å“åº”
```

## ğŸ”— ä¸‹ä¸€æ­¥

å®Œæˆæœ¬æ•™ç¨‹åï¼Œæ‚¨å¯ä»¥ç»§ç»­ï¼š

- **[é«˜çº§å·¥å…·æ¨¡å¼](../advanced_tool_patterns/README.md)** - å¤æ‚å·¥å…·æ¶æ„
- **[è‡ªå®šä¹‰å·¥å…·å¼€å‘](../custom_tools/README.md)** - æ„å»ºè‡ªå®šä¹‰å·¥å…·
- **[å·¥å…·é›†æˆ](../tool_integration/README.md)** - é›†æˆå¤–éƒ¨API

## ğŸ“š é™„åŠ èµ„æº

- [Google ADKå·¥å…·å›è°ƒ](https://google.github.io/adk-docs/callbacks/types-of-callbacks/#tool-execution-callbacks)
- [å·¥å…·å¼€å‘æŒ‡å—](https://google.github.io/adk-docs/tools/)
- [FunctionToolæ–‡æ¡£](https://google.github.io/adk-docs/tools/function-tools/)